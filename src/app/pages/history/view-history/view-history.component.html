<div class="mt-4">
    <div class="flex justify-between items-center mb-3">
    <input
        type="text"
        [(ngModel)]="searchTerm"
        (input)="applyFilterRequests()"
        placeholder="Search by patient name..."
        class="border border-gray-400 rounded-md p-2 w-1/3 outline-none"
        />
    </div>

    <table>
    <thead>
        <tr>
            <th>Control No.</th>
            <th>Name of Requestor</th>
            <th>Representative Name</th>
            <th>Address</th>
            <th>Contact Number</th>
            <th>Amount</th>
            <th>Request Date</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @for (request of paginatedData; track $index) {
        <tr>
            <td>{{request.control_number}}</td>
            <td>{{request.patients_name}}</td>
            <td>{{request.representative_name}}</td>
            <td>{{request.address}}</td>
            <td>{{request.contact_number}}</td>
            <td>{{request.amount}}</td>
            <td>{{request.request_date}}</td>
            <td><button (click)="openModifyModal(request)">Modify</button></td>
        </tr>
        }
    </tbody>
    </table>
    <div class="flex justify-center items-center gap-3 mt-4 pagination">
        <button (click)="previousPageRequests()" [disabled]="currentPage === 1">Previous</button>
            <span>Page {{currentPage}} of {{totalPages}}</span>
        <button (click)="nextPageRequests()" [disabled]="currentPage === totalPages">Next</button>
    </div>
</div>

<div *ngIf="isModalOpen" class="h-dvh w-full bg-black/50 fixed top-0 left-0 flex items-center justify-center z-50">
    <div class="w-1/3 bg-white p-5 rounded-xl">
        <h2 class="text-lg font-semibold mb-4">Modify Request</h2>

        <div class="space-y-3">
        <input type="text" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.control_number"
            placeholder="Control No." />

        <input type="text" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.patients_name"
            placeholder="Patient Name" />

        <input type="text" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.representative_name"
            placeholder="Representative Name" />

        <input type="text" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.address"
            placeholder="Address" />

        <input type="text" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.contact_number"
            placeholder="Contact Number" />

        <input type="number" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.amount"
            placeholder="Amount" />

        <input type="date" class="w-full border p-2 rounded"
            [(ngModel)]="selectedRequest.request_date" />
        </div>
        <div class="mt-4 border-t pt-4 space-y-3">

        <label class="flex items-center gap-2 text-sm">
            <input
            type="checkbox"
            [(ngModel)]="isCancelChecked"
            class="accent-red-600"
            />
            <span class="text-red-600 font-medium">
            Cancel this request
            </span>
        </label>

        <textarea
            *ngIf="isCancelChecked"
            class="w-full border p-2 rounded"
            rows="3"
            placeholder="Reason for canceling..."
            [(ngModel)]="cancelReason">
        </textarea>


        <div class="flex justify-end gap-3 mt-5">
        <button
            class="px-4 py-2 bg-gray-400 rounded"
            (click)="closeModal()">
            Cancel
        </button>

        <button
            class="px-4 py-2 bg-green-600 text-white rounded disabled:opacity-50"
            [disabled]="isCancelChecked && !cancelReason.trim()"
            (click)="updateRequest()">
            Save
        </button>
        </div>
    </div>
</div>
